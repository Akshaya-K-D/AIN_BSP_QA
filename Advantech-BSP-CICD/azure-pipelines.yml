trigger:
  - main

pool:
  vmImage: 'windows-latest'

stages:
- stage: Build
  displayName: "Build BSP"
  jobs:
    - job: android
      steps:
        - checkout: self

        # Debug: list files to confirm build.bat path
        - script: dir /s /b
          displayName: "List repository files"

        # Run Android build script
        - script: |
            if exist android\build.bat (
              echo "Running Android build script..."
              android\build.bat
            ) else (
              echo "Error: build.bat not found!"
              exit 1
            )
          displayName: "Run Android build script (Windows)"

- stage: QA
  displayName: "Run QA Scripts"
  dependsOn: Build
  jobs:
    - job: qa
      steps:
        - task: UsePythonVersion@0
          inputs:
            versionSpec: "3.x"

        - script: |
            if not exist reports mkdir reports
            cd qa-scripts
            python test_usb.py > ..\reports\usb_report.txt
            python test_internet.py > ..\reports\internet_report.txt
            python test_sdcard.py > ..\reports\sdcard_report.txt
          displayName: "Run Python QA Tests"

        - task: PublishBuildArtifacts@1
          inputs:
            PathtoPublish: "reports"
            ArtifactName: "Reports"
            publishLocation: "Container"